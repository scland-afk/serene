<!DOCTYPE html>
<html lang="en">
    <head>
        {% if page.url == "/" %}
        <!-- Preload LCP hero image without forcing desktop-size on mobile -->
        <!-- Note: use media-scoped `imagesrcset` so browsers pick the right size early -->
        <link
            rel="preload"
            as="image"
            media="(max-width: 600px)"
            href="{% getUrl "/assets/images/retaining-wall-backyard.webp" | resize({ width: 640, height: 800 }) | webp({ quality: 65 }) %}"
            imagesrcset="{% getUrl "/assets/images/retaining-wall-backyard.webp" | resize({ width: 360, height: 450 }) | webp({ quality: 65 }) %} 360w, {% getUrl "/assets/images/retaining-wall-backyard.webp" | resize({ width: 480, height: 600 }) | webp({ quality: 65 }) %} 480w, {% getUrl "/assets/images/retaining-wall-backyard.webp" | resize({ width: 640, height: 800 }) | webp({ quality: 65 }) %} 640w"
            imagesizes="100vw"
        >
        <link
            rel="preload"
            as="image"
            media="(min-width: 601px)"
            href="{% getUrl "/assets/images/retaining-wall-backyard.webp" | resize({ width: 1280, height: 800 }) | webp({ quality: 65 }) %}"
            imagesrcset="{% getUrl "/assets/images/retaining-wall-backyard.webp" | resize({ width: 960, height: 600 }) | webp({ quality: 65 }) %} 960w, {% getUrl "/assets/images/retaining-wall-backyard.webp" | resize({ width: 1280, height: 800 }) | webp({ quality: 65 }) %} 1280w, {% getUrl "/assets/images/retaining-wall-backyard.webp" | resize({ width: 1600, height: 1000 }) | webp({ quality: 65 }) %} 1600w"
            imagesizes="100vw"
        >
        {% endif %}
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        {% if client.isProduction %}
        <!-- GA4 + Clarity deferred until after load to reduce LCP render delay (~270ms savings) -->
        <script>
            window.dataLayer = window.dataLayer || [];
            window.gtag = window.gtag || function () { window.dataLayer.push(arguments); };

            window.addEventListener("load", function () {
                var gaId = "G-VPZBBTMB1R";
                window.gtag("js", new Date());
                window.gtag("config", gaId);
                var gtm = document.createElement("script");
                gtm.async = true;
                gtm.src = "https://www.googletagmanager.com/gtag/js?id=" + encodeURIComponent(gaId);
                document.head.appendChild(gtm);
            });

            window.addEventListener("load", function () {
                var clarity = document.createElement("script");
                clarity.async = true;
                clarity.src = "https://www.clarity.ms/tag/vcjpxa0bzr";
                document.head.appendChild(clarity);
            });
        </script>
        <link rel="preconnect" href="https://www.googletagmanager.com" crossorigin>
        <link rel="preconnect" href="https://www.clarity.ms" crossorigin>
        <link rel="preconnect" href="https://scripts.clarity.ms" crossorigin>
        {% endif %}

        <!-- critical.css render-blocking: variables, resets, hero, nav shell -->
        <link rel="stylesheet" href="/assets/css/critical.css">

        <!-- root.css non-blocking on all pages to reduce LCP (~220ms savings) -->
        <link rel="preload" href="/assets/css/root.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/assets/css/root.css"></noscript>

        <title>{{ title }}</title>
        <meta name="description" content="{{ description or 'Professional landscaping in Edmonton, St. Albert & Sherwood Park. Final grading, sod, retaining walls, and design. Book a free quote. Call 587-566-9879.' }}">
        {% if keywords %}<meta name="keywords" content="{{ keywords }}">{% endif %}
        <link rel="canonical" href="{{ client.domain }}{{ page.url }}">

        <meta property="og:title" content="{{ title }}">
        <meta property="og:description" content="{{ description or 'Professional landscaping in Edmonton, St. Albert & Sherwood Park. Final grading, sod, retaining walls, and design. Book a free quote. Call 587-566-9879.' }}">
        <meta property="og:type" content="website">
        <meta property="og:url" content="{{ client.domain }}{{ page.url }}">
        <meta property="og:image" content="{{ client.domain }}{{ image or '/assets/favicons/apple-touch-icon.png' }}">
        <meta property="og:image:secure_url" content="{{ client.domain }}{{ image or '/assets/favicons/apple-touch-icon.png' }}">

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{ title }}">
        <meta name="twitter:description" content="{{ description or 'Professional landscaping in Edmonton, St. Albert & Sherwood Park. Final grading, sod, retaining walls, and design. Book a free quote. Call 587-566-9879.' }}">
        <meta name="twitter:image" content="{{ client.domain }}{{ image or '/assets/favicons/apple-touch-icon.png' }}">

        <link rel="icon" type="image/png" href="/assets/favicons/favicon-96x96.png" sizes="96x96">
        <link rel="icon" type="image/svg+xml" href="/assets/favicons/favicon.svg">
        <link rel="shortcut icon" href="/assets/favicons/favicon.ico">
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/favicons/apple-touch-icon.png">
        <meta name="apple-mobile-web-app-title" content="{{ client.name }}">
        <link rel="manifest" href="/assets/favicons/site.webmanifest">

        <link rel="preload" as="image" href="/assets/svgs/logo-black.svg">
        <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/oswald-v57-latin-regular.woff2" crossorigin>
        <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/oswald-v57-latin-700.woff2" crossorigin>
        <link rel="preload" as="font" type="font/woff2" href="/assets/fonts/open-sans-v44-latin-regular.woff2" crossorigin>

        <script defer src="/assets/js/dark.js"></script>
        <script defer src="/assets/js/nav.js"></script>
        <script defer src="/assets/js/faq.js"></script>
        <script defer src="/assets/js/touch-interactions.js"></script>

        {% block head %}{% endblock %}

        <style>
            .sticky-quote-button {
                position: fixed;
                bottom: 2rem;
                right: 2rem;
                background: var(--primary);
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 50px;
                border: none;
                font-weight: 600;
                font-size: 1rem;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 999;
                display: none;
                align-items: center;
                justify-content: center;
                transition: transform 0.3s, box-shadow 0.3s;
                text-decoration: none;
            }
            .sticky-quote-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 16px rgba(0,0,0,0.2);
            }
            .sticky-quote-button.is-visible {
                display: flex;
            }
            .exit-intent-popup {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                z-index: 10000;
                display: none;
                align-items: center;
                justify-content: center;
            }
            .exit-intent-content {
                background: white;
                padding: 2rem;
                border-radius: 8px;
                max-width: 500px;
                width: 90%;
                position: relative;
                max-height: 90vh;
                overflow-y: auto;
            }
            .exit-intent-content h3,
            .exit-intent-content p {
                text-align: center;
            }
            .exit-close {
                position: absolute;
                top: 1rem;
                right: 1rem;
                background: none;
                border: none;
                font-size: 2rem;
                cursor: pointer;
                color: #666;
            }
        </style>
    </head>
    <body class="preload">
        <a class="skip" aria-label="skip to main content" href="#main">Click To Skip To Main Content</a>

        {% include "sections/header.html" %}
        <main id="main">
            {% block body %}{% endblock %}
        </main>
        {% include "sections/footer.html" %}

        <a id="sticky-quote-btn" class="sticky-quote-button" href="tel:{{ client.phoneForTel }}" aria-label="Call for a free quote">
            Call Now
        </a>

        <div id="exit-intent-popup" class="exit-intent-popup" style="display: none;">
            <div class="exit-intent-content">
                <button id="close-exit-popup" class="exit-close" aria-label="Close popup">&times;</button>
                <h3 style="color: var(--primary); font-size: 1.5rem; margin-bottom: 0.5rem;">Now Booking for Spring 2026</h3>
                <p style="font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; color: #333;">Get $500 off your landscaping project if booking before February 28, 2026 (minimum spend $5,000).</p>
                <form id="exit-quote-form" action="/contact/" method="get" style="display: flex; flex-direction: column; gap: 0.75rem;">
                    <input type="text" name="name" placeholder="Name" required style="padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                    <input type="email" name="email" placeholder="Email" required style="padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                    <input type="tel" name="phone" placeholder="Phone" required style="padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                    <select name="service" style="padding: 0.75rem; border: 1px solid #ddd; border-radius: 4px;">
                        <option value="">Service Interest</option>
                        <option value="landscape-design">Landscape Design</option>
                        <option value="retaining-walls">Retaining Walls</option>
                        <option value="lawn-maintenance">Lawn Maintenance</option>
                        <option value="snow-removal">Snow Removal</option>
                        <option value="commercial">Commercial Services</option>
                    </select>
                    <input type="hidden" name="offer" value="spring2026-500off">
                    <button type="submit" class="cs-button-solid" style="width: 100%;">Book Free Estimate</button>
                </form>
            </div>
        </div>

        <div class="cs-lightbox" id="gallery-48-lightbox" aria-hidden="true">
            <div class="cs-lightbox__backdrop" data-action="close"></div>
            <div class="cs-lightbox__panel" role="dialog" aria-modal="true" aria-label="Gallery image" tabindex="-1">
                <div class="cs-lightbox__header">
                    <span class="cs-lightbox__count">1 / 1</span>
                    <button class="cs-lightbox__close" type="button" data-action="close" aria-label="Close">✕</button>
                </div>
                <button class="cs-lightbox__nav cs-lightbox__prev" type="button" data-action="prev" aria-label="Previous image">‹</button>
                <figure class="cs-lightbox__figure">
                    <img class="cs-lightbox__image" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'/%3E" alt="Gallery image" data-initialized="false">
                    <figcaption class="cs-lightbox__caption"></figcaption>
                </figure>
                <button class="cs-lightbox__nav cs-lightbox__next" type="button" data-action="next" aria-label="Next image">›</button>
            </div>
        </div>

        <script>
            const stickyBtn = document.getElementById('sticky-quote-btn');
            if (stickyBtn) {
                window.addEventListener('scroll', () => {
                    stickyBtn.classList.toggle('is-visible', window.scrollY > 300);
                }, { passive: true });
            }

            const closeBtn = document.getElementById('close-exit-popup');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    document.getElementById('exit-intent-popup').style.display = 'none';
                });
            }

            const popup = document.getElementById('exit-intent-popup');
            if (popup) {
                popup.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            }
        </script>
    </body>
</html>
